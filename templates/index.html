<!DOCTYPE html>
<html>
<head>
    <title>Dagify Tool Converter</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"> 
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link rel="stylesheet" href="static/style.css"> 
</head>
<body>
    <div class="container"> 
        <div class="row justify-content-center">
            <div class="col-md-6">

                <h1 class="text-center mt-5">Convert your jobs to Airflow DAGs!</h1>

                <form id="upload-form" method="post" enctype="multipart/form-data" class="mt-4">
                    <div class="mb-3">
                        <input type="file" name="source_file" id="file-input" class="form-control">
                    </div>

                    <div id="alertContainer" class="mt-3"></div> 

                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-arrow-repeat me-2"></i> 
                        Convert</button>
                </form>

                {% if download_link %}
                    <div class="download-box mt-4">
                        <p><a href="{{ download_link }}" download class="btn btn-light-green" >
                            <i class="bi bi-download me-2"></i> 
                            Download Output DAGs</a></p>
                    </div>
                {% endif %}

            </div> 
        </div>
    </div>

    <script>
        const form = document.getElementById('upload-form');
        const alertContainer = document.getElementById('alertContainer');

        form.addEventListener('submit', (event) => {
            const fileInput = document.querySelector('input[type="file"]');
            
            if (!fileInput.files || fileInput.files.length === 0) {
                event.preventDefault();
                showAlert("Please upload a file!");
            } else {
                const file = fileInput.files[0];
                const fileName = file.name;
                const fileExtension = fileName.split('.').pop().toLowerCase();

                if (fileExtension !== 'xml') {
                    event.preventDefault();
                    showAlert("Please upload an XML file!");
                }
            }
        });

        function showAlert(message) {
            // Remove any existing alerts
            alertContainer.innerHTML = '';

            // Create the Bootstrap alert
            const alert = document.createElement('div');
            alert.classList.add('alert', 'alert-danger', 'alert-dismissible', 'fade', 'show');
            alert.setAttribute('role', 'alert');
            alert.innerHTML = `
              ${message}
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            `;

            // Add the alert to the container
            alertContainer.appendChild(alert);
        }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>

